
<app-projects-modal *ngIf="showProjectsModal" [projects]="projectList" (selectedProject)="onModalClosed($event)" (cancel)="onModalCancelClick()"></app-projects-modal>

<div *ngIf="display" class="container-fluid">

    <div class="col-sm col-custom col-slider" (click)="showSliderDisabledToast()">
        <nouislider [config]="mainSliderConfig" [tooltips]="[ false, false ]" [(ngModel)]="sliderRange" [disabled]="sliderDisabled" (update)="onSliderUpdate($event)" (change)="onSliderChange($event)"></nouislider>
    </div>


    <div class="row row-custom top-margin"> <!-- begin row for FTE entry table -->
        <div *ngIf="!displayFTETable" class="col-sm col-custom fte-table-container">
            <p>no FTE data for the selected period</p>
        </div>

        <div *ngIf="displayFTETable" class="col-sm col-custom fte-table-container">
            <form [formGroup]="FTEFormGroup">
                <div formArrayName="FTEFormArray">
                    <table>
                        <thead>
                            <tr> <!-- first row of table is month-name column-headers -->
                                <th colspan="2" class="firstColumnHeader top-corner">Project</th>
                                <!-- loop through each month in the userFTEs data object-->
                                <ng-container *ngFor="let month of months; let k = index">
                                    <!-- only show the month column if the slider deems it visible -->
                                    <th class="first-row-header" [@colState]="fteMonthVisible[k]" [style.display]="fteMonthVisible[k] ? '' : 'none'">{{month | date:'MMM-yyyy':'+0'}}</th>
                                </ng-container>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- loop through each project, one row per project -->
                            <ng-container *ngFor="let project of projects; let i = index">
                                <tr [formGroupName]="i" [style.display]="(fteProjectVisible[i] && project.alive) ? '' : 'none'">
                                    <td class="icon"> <!-- for trash icon -->
                                        <i *ngIf="fteProjectDeletable[i]" class="fa fa-trash-o" (click)="onTrashClick(i)"></i>
                                    </td>
                                    <td class="firstColumnHeader">{{ (project.projectName.length > 15) ? (project.projectName | slice:0:15) + '...' : (project.projectName) }}</td>
                                    <!-- loop through each month's FTE allocation, "monthly" cells per project -->
                                    <ng-container *ngFor="let month of months; let j = index">
                                        <!-- only show if slider deems it visible -->
                                        <td [@colState]="fteMonthVisible[j]" [formGroupName]="j" [style.display]="fteMonthVisible[j] ? '' : 'none'">
                                            <input type="text" formControlName="fte" class="form-control" [attr.disabled]="fteMonthEditable[j] ? null : ''" (change)="onFTEChange(i, j, $event.target.value)" appFteInputRestrict>
                                        </td>
                                    </ng-container>
                                </tr>
                            </ng-container>
                        </tbody>
                        <tfoot>
                            <tr>
                                <td class="icon">&nbsp;</td> <!-- for trash icon -->
                                <td class="firstColumnHeader">TOTAL</td>
                                <ng-container *ngFor="let month of months; let z = index">
                                    <td *ngIf="fteMonthVisible[z]">
                                        <input disabled [value]="monthlyTotals[z] | number:'1.1'" type="text" [class]="'form-control' + (!monthlyTotalsValid[z] ? ' highlight-invalid' : '')" [attr.month-index]="z">
                                    </td>
                                </ng-container>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </form>
        </div> <!-- end div that controls entire FTE entry table visibility -->
    </div> <!-- end row for FTE entry table -->

    <div class="test-buttons">
        <button class="btn btn-primary" (click)="onAddProjectClick()">Add Project</button>
        <button class="btn btn-primary" (click)="onTestFormClick()">Test Form Data</button>
        <button class="btn btn-primary" (click)="onSaveClick()">Save</button>
        <button class="btn btn-primary" (click)="exportXLSX()">Export</button>
    </div>

</div> <!-- end FTE component container div -->
