<app-projects-edit-modal *ngIf="showProjectsEditModal" [projectData]="projectData" [projectAccessRequestsList]="projectAccessRequestsList" (updateSuccess)="onUpdateSuccess()" (deleteSuccess)="onDeleteSuccess()"></app-projects-edit-modal>
<app-projects-create-modal *ngIf="showProjectsCreateModal" (createSuccess)="onCreateSuccess()"></app-projects-create-modal>

<!-- Delete Confirmation Modal -->
<div class="modal" tabindex="-1" role="dialog" id="deleteModal">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <h5 *ngIf="!disableDelete">Are you sure you want to delete this project?</h5>
          <h6 *ngIf="disableDelete">This project can't be deleted because people have logged FTE on it.</h6>
          <div *ngIf="showDetails">
            <hr>
            <p>Project Tables:</p>
              <li *ngFor="let list of pKeyRefList">Table: {{ list.TableName }} | Count: {{ list.NumOfRows }}</li>
          </div>
        </div>
        <div class="modal-footer">
          <button *ngIf="!disableDelete" type="button" class="btn btn-outline-danger" data-dismiss="modal" [disabled]="disableDelete" (click)="onDeleteProjectClick()" (deleteSuccess)="onDeleteSuccess()">Delete</button>
          <button *ngIf="disableDelete" type="button" class="btn btn-outline-secondary" (click)="onDetailsClick()">Details</button>
          <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Cancel</button>
        </div>
      </div>
    </div>
  </div>
  <!--  -->

  <!-- Deny Request Modal -->
  <div class="modal" tabindex="-1" role="dialog" id="requestDenyModal">
    <div class="modal-dialog" role="document">
      <div class="modal-content" style="padding: 30px; width:150%">

        <div class="input-group">
          <input type="text" class="form-control" placeholder="Add a comment" aria-label="Recipient's username" aria-describedby="basic-addon2">
          <div class="input-group-append">
            <button type="button" class="btn btn-primary btn-fte-toolbar" data-dismiss="modal" (click)="requestResponse(request, 'Denied')"><i class="fa fa-paper-plane" aria-hidden="true"></i>&nbsp;&nbsp;Send</button>&nbsp;
            <button type="button" class="btn btn-primary btn-fte-toolbar" data-dismiss="modal"><i class="fa fa-ban" aria-hidden="true"></i>&nbsp;&nbsp;Cancel</button>
          </div>
        </div>
        
      </div>
    </div>
  </div>
  <!--  -->

<div class="container-fluid">
    <!-- HEADER -->
  <div class="row row-custom">
    <div class="col-xs-12 col-custom">
      <h1 class="page-header-text">My Projects</h1>
    </div>
  </div>

  <div class="card" style="display: inline-block; margin-bottom: 1rem;" *ngIf="requestResponseFlag">
      <div class="card-header">
          People are requesting access to your projects:
        </div>
    <ng-container *ngFor="let request of projectAccessRequestsList">
      <div class="card-body" *ngIf="request.requestStatus=='Submitted'">
        <p class="card-text" style="line-height: 32px">{{ request['user.fullName'] }} has requested access to {{ request['project.projectName'] }}&nbsp;&nbsp;
          <span class="float-right">
            <button type="button" class="btn btn-primary btn-fte-toolbar" (click)="requestResponse(request, 'Approved')"><i class="fa fa-check" aria-hidden="true"></i>&nbsp;&nbsp;Accept</button>
            <!-- <button type="button" class="btn btn-primary btn-fte-toolbar" (click)="requestResponse(request, 'Denied')"><i class="fa fa-times" aria-hidden="true"></i>&nbsp;&nbsp;Deny</button> -->
            <button type="button" class="btn btn-primary btn-fte-toolbar" data-toggle="modal" data-target="#requestDenyModal"><i class="fa fa-times" aria-hidden="true"></i>&nbsp;&nbsp;Deny</button>
          </span>
        </p>
      </div>
    </ng-container>
    </div>

  <button class="btn btn-primary btn-fte-toolbar" style="display: block" (click)="createProject()" data-toggle="modal" data-target="#projectsCreateModal">
    <i class="fa fa-plus"></i>&nbsp;&nbsp;Project
  </button>

  <br>
  
  <!-- ACCORDION START -->
  <div class="accordion" id="accordionProjectList">
    <div class="card">
      <table class="table table-hover">

        <!-- PROJECT HEADER START -->    
        <thead>
          <tr>
            <th width="30%">Project Name</th>
            <th width="10%">Project Type</th>
            <th width="30%">Description</th>
            <th width="30%">Notes</th>
            <th></th>
            <th></th>
          </tr>
        </thead>
        <!-- PROJECT HEADER END -->
        
        <ng-container *ngFor="let project of projectList; let k = index" class="table-container">

        <!-- PROJECT LIST START -->
          <tbody>
            <tr class="card-header-custom" [class.active]="k == selectedRow" [attr.id]="k">
              <td data-toggle="collapse" [attr.data-target]="'#collapse'+ k" aria-expanded="false" (click)="onCollapseClick(project, k)">{{ (project['projectName'].length > 70) ? (project['projectName'] | slice:0:67) + '...' : (project['projectName']) }}</td>
              <td data-toggle="collapse" [attr.data-target]="'#collapse'+ k" aria-expanded="false" (click)="onCollapseClick(project, k)">{{ project['projectType.projectTypeName'] }}</td>
              <td data-toggle="collapse" [attr.data-target]="'#collapse'+ k" aria-expanded="false" (click)="onCollapseClick(project, k)" *ngIf="!project.description">{{ project['description'] }}</td>
              <td data-toggle="collapse" [attr.data-target]="'#collapse'+ k" aria-expanded="false" (click)="onCollapseClick(project, k)" *ngIf="project.description">{{ (project['description'].length > 20) ? (project['description'] | slice:0:20) + '...' : (project['description']) }}</td>
              <td data-toggle="collapse" [attr.data-target]="'#collapse'+ k" aria-expanded="false" (click)="onCollapseClick(project, k)" *ngIf="!project.notes">{{ project['notes'] }}</td>
              <td data-toggle="collapse" [attr.data-target]="'#collapse'+ k" aria-expanded="false" (click)="onCollapseClick(project, k)" *ngIf="project.notes">{{ (project['notes'].length > 20) ? (project['notes'] | slice:0:20) + '...' : (project['notes']) }}</td>
              <!-- Edit and Delete Button - Show only if user is the project creator -->
              <td>
                <i *ngIf="loggedInUser.id===project.createdBy" class="fa fa-pencil-square-o fa-lg" aria-hidden="true" data-toggle="modal" data-target="#projectsEditModal" (click)="selectProject(project)"></i>
              </td>
              <td>
                <i *ngIf="loggedInUser.id===project.createdBy" class="fa fa-trash-o fa-lg" aria-hidden="true" data-toggle="modal" data-target="#deleteModal" (click)="getPrimaryKeyRefs(project.id)"></i>
              </td>
            </tr>
          
        <!-- PROJECT LIST END -->

        <!-- COLLAPSABLE CARD-BODY START-->
        
          <tr class="table-container" id="collapse{{k}}" class="collapse" [attr.aria-labelledby]="k" data-parent="#accordionProjectList">
            <td class="card-body main-card-body align-middle" colspan="6">
              <div class="card-deck">

                <div class="card border mb-3 table-container">
                  <div class="card-body">
                    <h5 class="card-title">Basic Info</h5>
                    <table class="table table-sm">
                        <!-- <tbody> -->
                          <tr *ngFor="let rows of cardNPI">
                            <td>{{ rows.title }}</td>
                            <td>{{ rows.value }}</td>
                          </tr>
                        <!-- </tbody> -->
                    </table>
                  </div>
                </div>

                <div class="card border mb-3 table-container">
                  <div class="card-body">
                    <h5 class="card-title">Project Team</h5>
                    <table class="table table-sm">
                      <tbody>
                        <!-- <tr>{{ projectRoster?.projectID }}</tr> -->
                        <tr *ngFor="let teamMember of projectRoster?.teamMembers">
                          <td>{{ teamMember.name }}</td>
                          <td>{{ teamMember.jobTitle }}</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>

              <div class="card border mb-3 table-container">
                <div class="card-body">
                  <h5 class="card-title">Schedule</h5>
                  <table class="table table-sm">
                    <tbody>
                      <tr>
                        <td>CON</td>
                        <td>06/05/2018</td>
                      </tr>
                      <tr>
                        <td>INV</td>
                        <td>06/05/2018</td>
                      </tr>
                      <tr>
                        <td>DEF</td>
                        <td>06/05/2018</td>
                      </tr>
                      <tr>
                        <td>HQ</td>
                        <td>06/05/2018</td>
                      </tr>
                      <tr>
                        <td>RSR</td>
                        <td>06/05/2018</td>
                      </tr>
                      <tr>
                        <td>SHP</td>
                        <td>06/05/2018</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>

              <!-- <div class="card border mb-3 table-container">
                <div class="card-body">
                  <h5 class="card-title">Version Control</h5>
                  <table>
                    <tr colspan="2">
                      <td>Created By</td>
                      <td>Tawanchai Schmitz</td> 
                      <td>06/01/2018</td>                   
                    </tr>
                    <tr>
                      <td>Last Updated</td>   
                      <td>Tawanchai Schmitz</td>  
                      <td>06/01/2018</td>                      
                    </tr>
                  </table>
                </div>
              </div> -->

            </div>
            </td>
            
          </tr>

          <tr>
            
          </tr>
        
        <!-- COLLAPSABLE CARD-BODY END -->
      </tbody>
        </ng-container>
      </table>
    </div>
  </div>
</div>