<app-projects-edit-modal *ngIf="showProjectsEditModal" [projectData]="projectData" [projectPermissionRequestsList]="projectPermissionRequestsList" (updateSuccess)="onUpdateSuccess()" (deleteSuccess)="onDeleteSuccess()"></app-projects-edit-modal>
<app-projects-create-modal *ngIf="showProjectsCreateModal" (createSuccess)="onCreateSuccess()"></app-projects-create-modal>

<!-- Request-Denied Modal -->
<!-- Might be moved to it's own component -->
<div class="modal" tabindex="-1" role="dialog" id="requestDenyModal">
  <div class="modal-dialog" role="document">
    <div class="modal-content" style="width:150%">
      <div class="modal-header" style="border-bottom: none; height: 2rem;">
        <h5 class="title">Please add a comment</h5>
      </div>
      <div class="modal-body">
      <div class="input-group">
        <input [(ngModel)]="replyComment" type="text" class="form-control" placeholder="Add a comment">
        <div class="input-group-append">
          <button type="button" class="btn btn-primary btn-fte-toolbar" data-dismiss="modal" (click)="requestResponse(request, 'Denied', replyComment)"><i class="fa fa-paper-plane" aria-hidden="true"></i>&nbsp;&nbsp;OK</button>&nbsp;
          <button type="button" class="btn btn-primary btn-fte-toolbar" data-dismiss="modal"><i class="fa fa-ban" aria-hidden="true"></i>&nbsp;&nbsp;Cancel</button>
        </div>
      </div>
      </div>
    </div>
  </div>
</div>
<!--  -->

<!-- Edit Project Role Modal -->
<div class="modal fade" tabindex="-1" role="dialog" id="projectRoleModal">
  <div class="modal-dialog" role="document">
    <div class="modal-content" style="width:150%">
      <div class="modal-header" style="border-bottom: none; height: 2rem;">
        <h5 class="title">Change your role for this project</h5>
      </div>
      <div class="modal-body">
      <div class="input-group">
        <input [(ngModel)]="replyComment" type="text" class="form-control" placeholder="Add a comment">
        <div class="input-group-append">
          <button type="button" class="btn btn-primary btn-fte-toolbar" data-dismiss="modal" (click)="requestResponse(request, 'Denied', replyComment)"><i class="fa fa-paper-plane" aria-hidden="true"></i>&nbsp;&nbsp;OK</button>&nbsp;
          <button type="button" class="btn btn-primary btn-fte-toolbar" data-dismiss="modal"><i class="fa fa-ban" aria-hidden="true"></i>&nbsp;&nbsp;Cancel</button>
        </div>
      </div>
      </div>
    </div>
  </div>
</div>
<!--  -->

<div class="container-fluid">

  <!-- Request Alerts -->
  <div class="card" style="display: inline-block; margin-bottom: 1rem;" *ngIf="requestResponseFlag">
      <div class="card-header">
        <div><h6>People are requesting access to your projects:</h6></div>
      </div>
    <ng-container *ngFor="let request of projectPermissionRequestsList">
      <div class="card-body" *ngIf="request.requestStatus=='Submitted'">
        <p class="card-text" style="line-height: 32px; margin-left: 1px">{{ request['user.fullName'] }} has requested access to {{ request['project.projectName'] }}&nbsp;&nbsp;
          <span class="float-right">
            <button type="button" class="btn btn-primary btn-fte-toolbar" (click)="requestResponse(request, 'Approved', 'Approved')"><i class="fa fa-check" aria-hidden="true"></i>&nbsp;&nbsp;Accept</button>
            <button type="button" class="btn btn-primary btn-fte-toolbar" data-toggle="modal" data-target="#requestDenyModal" (click)="onDenyClick(request)"><i class="fa fa-times" aria-hidden="true"></i>&nbsp;&nbsp;Deny</button>
          </span>
        </p>
      </div>
    </ng-container>
  </div>
  <!--  -->

  <!-- Create New Project Button -->
  <button class="btn btn-primary btn-fte-toolbar" style="display: block" (click)="createProject()" data-toggle="modal" data-target="#projectsCreateModal">
    <i class="fa fa-plus"></i>&nbsp;&nbsp;Create
  </button>
  <!--  -->

  <br>
  
  <!-- Project Table -->
  <div class="card">
    <!-- table headers start -->
    <div class="card-header">
      <div class="row header-project-table">
        <div class="col-2">
          <div><h6>Name</h6></div>
        </div>
        <div class="col-2">
          <div><h6>Project Type</h6></div>
        </div>
        <div class="col-4">
          <div><h6>Description</h6></div>
        </div>
        <div class="col-3">
          <div><h6>Notes</h6></div>
        </div>
        <div class="col-1">
          <div class="row">
            <div class="col-6">
              <div><h6></h6></div>
            </div>
            <div class="col-6">
              <div><h6></h6></div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- table headers end -->

    <!-- ACCORDION START -->
    <div class="accordion" id="accordionProjectList">
      <ng-container *ngFor="let project of projectList; let k = index" class="table-container">
        <!-- table row start -->
        <!-- <div class="card-header-custom" data-toggle="collapse" [attr.data-target]="'#collapse'+ k" aria-expanded="false" [class.active]="k==selectedRow" [attr.id]="k" (click)="onCollapseClick(project, k)"> -->
            <div class="card-header-custom" aria-expanded="false" [class.active]="k==selectedRow" [attr.id]="k" (click)="onCollapseClick(project, k)">
          <div class="col-2" data-toggle="collapse" [attr.data-target]="'#collapse'+ k" >
            <div>{{ (project['projectName'].length > 50) ? (project['projectName'] | slice:0:50) + '...' : (project['projectName']) }}</div>
          </div>
          <div class="col-2" data-toggle="collapse" [attr.data-target]="'#collapse'+ k" >
            <div>{{ project['projectType.projectTypeName'] }}</div>
          </div>
          <div *ngIf="!project.description" class="col-4" data-toggle="collapse" [attr.data-target]="'#collapse'+ k" >
            <div>{{ project['description'] }}</div>
          </div>
          <div *ngIf="project.description" class="col-4" data-toggle="collapse" [attr.data-target]="'#collapse'+ k" >
            <div>{{ (project['description'].length > 50) ? (project['description'] | slice:0:50) + '...' : (project['description']) }}</div>
          </div>
          <div *ngIf="!project.notes" class="col-3" data-toggle="collapse" [attr.data-target]="'#collapse'+ k" >
            <div>{{ project['notes'] }}</div>
          </div>
          <div *ngIf="project.notes" class="col-3" data-toggle="collapse" [attr.data-target]="'#collapse'+ k" >
            <div>{{ (project['notes'].length > 50) ? (project['notes'] | slice:0:50) + '...' : (project['notes']) }}</div>
          </div>
          <div *ngIf="loggedInUser.id===project.createdBy" class="col-1">
            <div class="row">
              <div class="col-6">
                <div><i class="fa fa-pencil-square-o fa-lg" aria-hidden="true" data-toggle="modal" data-target="#projectsEditModal" (click)="editProject(project)"></i></div>
              </div>
              <div class="col-6">
                <div><i class="fa fa-trash-o fa-lg" data-toggle="modal" data-target="#deleteModal" (click)="onDeleteProjectClick(project)"></i></div>
              </div>
            </div>
          </div>
          <div *ngIf="loggedInUser.id!==project.createdBy" class="col-1" data-toggle="collapse" [attr.data-target]="'#collapse'+ k"> 
            <div class="row">
              <div class="col">
              </div>
            </div>
          </div>
        </div>
        <!-- table row end --> 
        
        <!-- card collapse start -->
        <div id="collapse{{k}}" class="collapse" [attr.aria-labelledby]="k" data-parent="#accordionProjectList">
          <div class="card">
            <div class="card-body" style="background: #485b65">
              <div class="card-deck">

                <div class="card">
                  <div class="card-body table-responsive">
                    <h5 class="card-title">Basic Info</h5>
                    <table class="table table-sm">
                        <tbody>
                          <tr *ngFor="let field of projectBasicInfo">
                            <td>{{ field.field }}</td>
                            <td>{{ field.value }}</td>
                          </tr>
                        </tbody>
                    </table>
                  </div>
                </div>
              
                <div class="card">
                  <div class="card-body table-responsive">
                    <h5 class="card-title">Project Team</h5>
                    <table class="table table-sm">
                      <tbody>
                        <tr *ngFor="let teamMember of projectRoster?.teamMembers">
                          <td width="40%">{{ teamMember.name }}</td>
                          <td width = "55%">{{ teamMember.jobTitle }}</td>
                          <!-- <td width = "55%" *ngIf="toggleEditProjectRole && teamMember.name===loggedInUser.fullName">
                              <form>
                                <div class="form-group form-group-custom">
                                  <select class="custom-select custom-select-project-role" (change)="selectProjectRoleChangeHandler($event, project)">
                                    <option>Select a Job Title...</option>
                                    <option *ngFor="let role of projectRolesList">{{ role.projectRole }}</option>
                                  </select>
                                </div>
                              </form>
                          </td> -->
                          <td width = "5%"><i *ngIf="teamMember.name===loggedInUser.fullName" class="fa fa-pencil-square-o fa-sm" data-toggle="modal" data-target="#projectRoleModal" (click)="onProjectRoleEditClick()"></i></td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>

                <div class="card">
                  <div class="card-body table-responsive">
                    <h5 class="card-title">Schedule</h5>
                    <table class="table table-sm">
                      <tbody>
                        <tr *ngFor="let schedule of projectSchedule">
                          <td>{{ schedule.PLCStatusName}}</td>
                          <td>{{ schedule.PLCDate}}</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              
              </div>
              <footer class="blockquote-footer" style="padding-top: inherit; color: #b7bdc2;">
                <span style="font-weight: bold">Created By:</span> {{ project['createdByFullName'] }}, {{ project['createdAt'] | slice:0:10 }} &nbsp;&nbsp; 
                <span style="font-weight: bold">Last Updated:</span> {{ project['updatedByFullName'] }}, {{ project['updatedAt'] | slice:0:10 }}
              </footer>
            </div>
          </div>
        </div>
        <!-- card collapse end -->

      </ng-container>
    </div>
    <!-- ACCORDION END -->
    
  </div>
</div>