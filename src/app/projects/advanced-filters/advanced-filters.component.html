  <!-- spinner -->
<app-spinner *ngIf="showSpinner"></app-spinner>

<div class="container-fluid">

  <!-- outer page container; don't show until data is ready and hide while waiting for advancedFilterResults-->
  <div class="page-cont" *ngIf="showPage" [hidden]="showSpinner">

    <!-- Top Row -->
    <div class="projects-search-cont">

      <!-- <app-advanced-filters-typeahead></app-advanced-filters-typeahead> -->

      <div class="projects-search-label">
        Search
      </div>
    
      <!-- Search Input -->
      <div class="projects-search-string">
        <input #filterStringVC
            type="text"  
            class="form-control projects-search-input" 
            name="filterString" 
            [(ngModel)]="filterString" 
            placeholder="Project Name" 
            appAutofocus>      
        <i class="projects-search-icon-search fa fa-search"></i>
        <i class="projects-search-icon-close fa fa-times-circle" (click)="onClearSearchClick()"></i>
      </div>
      
      <!-- Test Button -->
      <!-- <button class="btn btn-primary" (click)="onTestFormClick()">Test Form Data</button> -->

      <!-- Filter Badges -->
      <ng-container *ngFor="let checkbox of filterCheckedArray; let a = index">
        <div class="badge badge-light">
          <!-- <i class="fa fa-times-circle filters-badge-icon" [attr.title]="checkbox" (click)="onBadgeCloseClick($event)"></i>   -->
          {{ checkbox }}
        </div>
      </ng-container>

      <!-- Export Button -->
      <div class="float-right-cont">

        <button class="btn-standard icon-text-only hover-green export-button" (mouseenter)="onExportButtonMouseEnter()" (mouseleave)="onExportButtonMouseLeave()" (click)="onExportClick()">
          <i class="fa fa-download button-icon"></i>
          Export
          <span class="downloading-animated-icon" [hidden]="!showDownloadingIcon"> 
            <svg viewBox="0 0 16 16" width="16" height="16"><title>ripples</title><g class="nc-icon-wrapper" fill="#4ad21c"><g class="nc-loop_ripples-16"> <circle fill="#4ad21c" cx="8" cy="8" r="8" transform="translate(0.5344666667779281 0.5344666667779281) scale(0.933191666652759)" style="opacity:0.33404166673620506;"></circle> </g> <script>!function(){function t(t){this.element=t,this.circle=this.element.getElementsByTagName("circle")[0],this.animationId,this.start=null,this.init()}if(!window.requestAnimationFrame){var i=null;window.requestAnimationFrame=function(t,n){var e=(new Date).getTime();i||(i=e);var a=Math.max(0,16-(e-i)),r=window.setTimeout(function(){t(e+a)},a);return i=e+a,r}}t.prototype.init=function(){var t=this;this.animationId=window.requestAnimationFrame(t.triggerAnimation.bind(t))},t.prototype.reset=function(){var t=this;window.cancelAnimationFrame(t.animationId)},t.prototype.triggerAnimation=function(t){var i=this;this.start||(this.start=t);var n=t-this.start,e=Math.min(n/800,1);800>n||(this.start=this.start+800);var a=.3+5*e/7;if(.3+e>1)(a=.8+2*(e-.7)/3);var r=8*(1-(a=Math.min(a,1))),o=8*(1-a),s=10*e/7;if(.3+e>1)(s=Math.max(1-10/3*(e-.7),0));this.circle.setAttribute("transform","translate("+r+" "+o+") scale("+a+")"),this.circle.setAttribute("style","opacity:"+s+";");if(document.documentElement.contains(this.element))window.requestAnimationFrame(i.triggerAnimation.bind(i))};var n=document.getElementsByClassName("nc-loop_ripples-16"),e=[];if(n)for(var a=0;n.length>a;a++)!function(i){e.push(new t(n[i]))}(a);document.addEventListener("visibilitychange",function(){"hidden"==document.visibilityState?e.forEach(function(t){t.reset()}):e.forEach(function(t){t.init()})})}(); </script></g></svg>
          </span>
        </button>

        <div class="projects-display-count">
          {{ numProjectsDisplayString }}
        </div>

      </div>

    </div>

    <!-- Filter Content -->
    <div class="filter-content" style="display: flex">

      <!-- Filter Column -->
      <div style="float: left; width:402px;">

        <div class="row">

          <!-- Filters 1 -->
          <div class="adv-filters-cont col">

            <!-- ProjectTypes -->
            <div class="filter-headers d-flex justify-content-between">
              <div data-toggle="collapse" data-target="#projectTypeFilters" style="cursor: pointer">
                <i class="fa fa-angle-down" aria-hidden="true" style="padding: 0px 10px 0px 3px"></i>
                Project Types
              </div>
              <div class="custom-control custom-checkbox">
                <input type="checkbox" checked class="custom-control-input" id="ProjectTypeIDs" (click)="onCheckAllClick($event)" [(ngModel)]="checkAllProjectTypes">
                <label class="custom-control-label" for="ProjectTypeIDs"><small style="margin: 0px 5px 0px -7px;">All</small></label>
              </div>
            </div>
            <div class="filter-collapse show" id="projectTypeFilters">
              <div class="custom-control custom-checkbox adv-filter-cb" *ngFor="let projectType of projectTypes; let i = index">
                <input type="checkbox" [checked]="checkAllProjectTypes" class="custom-control-input" [attr.name]="projectType.projectTypeName" [attr.id]="'projectType' + i" (click)="onCheckboxProjectTypeClick($event, projectType.id)">
                <label class="custom-control-label" [attr.for]="'projectType' + i" style="padding: 1px 0px 0px 10px;">{{ projectType.projectTypeName }}</label>
              </div>
            </div>

            <div style="height:10px; background: #f5f5f5"></div>

            <!-- ProjectOwner -->
            <div class="filter-headers d-flex justify-content-between">
              <div data-toggle="collapse" data-target="#managerTeamFilters" style="cursor: pointer">
                <i class="fa fa-angle-down" aria-hidden="true" style="padding: 0px 10px 0px 3px"></i>
                Project Owner
              </div>
              <div *ngIf="filterStringOw.value!=''" class="custom-control custom-checkbox">
                <input type="checkbox" class="custom-control-input" id="ProjectOwnerEmails" (click)="onCheckAllClick($event)" [(ngModel)]="checkAllProjectOwners">
                <label class="custom-control-label" for="ProjectOwnerEmails"><small style="margin: 0px 5px 0px -7px;">All</small></label>
              </div>
            </div>

            <div class="filter-collapse show" id="managerTeamFilters" style="height:168px">
              <div class="projects-search-string projects-owner my-1">
                <input type="text" #filterStringOw name="filterStringOwner" [(ngModel)]="filterStringOwner" class="form-control projects-search-input projects-owner typeahead" placeholder="Manager Name">      
                <i class="projects-search-icon-search fa fa-search"></i>
                <i class="projects-search-icon-close fa fa-times-circle" (click)="onClearOwnerClick()"></i>
              </div>
              <div *ngIf="filterStringOw.value!=''">
                <ng-container *ngFor="let managerEmployee of managerTeam; let l = index">
                  <div class="custom-control custom-checkbox" style="margin-left: 8px" [class.manager]="l==0">
                    <input type="checkbox" class="custom-control-input" [attr.name]="managerEmployee.fullName" [attr.id]="'owner' + l" [checked]="l===0 || checkAllProjectOwners" (click)="onCheckboxProjectOwnerClick($event, managerEmployee.EMAIL_ADDRESS)">
                    <label class="custom-control-label" [attr.for]="'owner' + l" style="padding: 1px 0px 0px 10px;">
                      <span>{{ managerEmployee.fullName }}</span>
                    </label>
                  </div>
                </ng-container>
              </div>
            </div>

            <div style="height:10px; background: #f5f5f5"></div>
              
          </div>

          <!-- Filters 2 -->
          <div class="adv-filters2-cont col">

            <!-- Priority -->
              <div class="filter-headers d-flex justify-content-between">

                <div data-toggle="collapse" data-target="#projectPrioritiesFilters">
                  <i class="fa fa-angle-down" aria-hidden="true" style="padding: 0px 10px 0px 3px"></i>
                  Project Priority
                </div>
                <div class="custom-control custom-checkbox">
                  <input type="checkbox" checked class="custom-control-input" id="ProjectPriorityIDs" (click)="onCheckAllClick($event)" [(ngModel)]="checkAllProjectPriorities">
                  <label class="custom-control-label" for="ProjectPriorityIDs"><small style="margin: 0px 5px 0px -7px;">All</small></label>
                </div>

              </div>

              <div class="filter-collapse show" id="projectPrioritiesFilters">
                <div class="custom-control custom-checkbox adv-filter-cb" *ngFor="let projectPriority of projectPriorities; let k = index">
                  <input type="checkbox" [checked]="checkAllProjectPriorities" class="custom-control-input" [attr.name]="projectPriority.priorityName" [attr.id]="'priority' + k" (click)="onCheckboxProjectPriorityClick($event, projectPriority.id)">
                  <label class="custom-control-label" [attr.for]="'priority' + k" style="padding: 1px 0px 0px 10px;">{{ projectPriority.priorityName }}</label>
                </div>
              </div>

            <div style="height:10px; background: #f5f5f5"></div>

            <!-- Status -->
              <div class="filter-headers d-flex justify-content-between">
                <div data-toggle="collapse" data-target="#projectStatusFilters">
                  <i class="fa fa-angle-down" aria-hidden="true" style="padding: 0px 10px 0px 3px"></i>
                  Project Status
                </div>
                <div class="custom-control custom-checkbox">
                  <input type="checkbox" checked class="custom-control-input" id="ProjectStatusIDs" (click)="onCheckAllClick($event)" [(ngModel)]="checkAllProjectStatuses">
                  <label class="custom-control-label" for="ProjectStatusIDs"><small style="margin: 0px 5px 0px -7px;">All</small></label>
                </div>
              </div>

              <div class="filter-collapse show" id="projectStatusFilters">
                <div class="custom-control custom-checkbox adv-filter-cb" *ngFor="let projectStatus of projectStatuses; let j = index">
                  <input type="checkbox" [checked]="checkAllProjectStatuses" class="custom-control-input" [attr.name]="projectStatus.projectStatusName" [attr.id]="'projectStatus' + j" (click)="onCheckboxProjectStatusClick($event, projectStatus.id)">
                  <label class="custom-control-label" [attr.for]="'projectStatus' + j" style="padding: 1px 0px 0px 10px;">{{ projectStatus.projectStatusName }}</label>
                </div>
              </div>

              <div style="height:10px; background: #f5f5f5"></div>

          </div>

        </div>

        <!-- 3rd advanced filter underneath the other 2 -->
        <div class="row">

          <div class="adv-filters3-cont col">

            <!-- FTE -->
            <div class="filter-headers d-flex justify-content-between">

              <div data-toggle="collapse" data-target="#fte">
                <i class="fa fa-angle-down" aria-hidden="true" style="padding: 0px 10px 0px 3px"></i>
                FTE Allocation
              </div>

              <button type="button" class="btn btn-outline-dark clear-fte" id="FTEMin" 
                      (click)="onFTEClearClick(); 
                              inputFTEFrom.value=''; inputFTETo.value=''; inputFTEMin.value=''; inputFTEMax.value='';">Clear
              </button>

            </div>

            <div class="filter-collapse show" id="fte">

              <!-- Toggle Buttons -->
              <div class="btn-group btn-group-toggle" data-toggle="buttons" style="width: 100%">
                <label class="btn btn-outline-secondary fte-toggle" id="all" style="width: 17%" (click)="onFTEToggleSelected($event); inputFTEFrom.value=''; inputFTETo.value=fteDateTo">
                  <input type="radio" name="options" id="option1" autocomplete="off"> All
                </label>
                <label class="btn btn-outline-secondary fte-toggle" id="month" (click)="onFTEToggleSelected($event); inputFTEFrom.value=fteDateFrom; inputFTETo.value=fteDateTo">
                  <input type="radio" name="options" id="option2" autocomplete="off" > Current Month
                </label>
                <label class="btn btn-outline-secondary fte-toggle" id="qtr" (click)="onFTEToggleSelected($event); inputFTEFrom.value=fteDateFrom; inputFTETo.value=fteDateTo">
                  <input type="radio" name="options" id="option3" autocomplete="off"> Current Quarter
                </label>
                <label class="btn btn-outline-secondary fte-toggle" id="year" (click)="onFTEToggleSelected($event); inputFTEFrom.value=fteDateFrom; inputFTETo.value=fteDateTo">
                  <input type="radio" name="options" id="option3" autocomplete="off"> Current Year
                </label>
              </div>

              <!-- Date Range -->
              <div class="d-flex justify-content-between">
                  <div class="form-group" style="margin-bottom: 4px;">
                    <label for="fteFrom" class="fte">Date Range</label>
                    <input #inputFTEFrom
                        class="form-control fte"
                        [class.plc-input-invalid]="inputFTEFrom.validity.valid===false"
                        id="fteFrom" 
                        type="date"
                        (change)="onInputFTEChange($event)">
                  </div>

                  <span style="margin-top: 7px">-</span>

                  <div class="form-group" style="margin-bottom: 4px;"> 
                    <input #inputFTETo
                        class="form-control fte"
                        [class.plc-input-invalid]="inputFTETo.validity.valid===false"
                        id="fteTo" 
                        type="date" 
                        [min]="minDate" 
                        (change)="onInputFTEChange($event)">
                  </div>
                  <!-- Placeholder -->
                  <div class="form-group" style="margin-bottom: 4px; width: 31px"></div>
              </div>

              <!-- Total FTEs Min and Max  -->
              <div class="d-flex justify-content-between">
                  <div class="form-group" style="margin-bottom: 4px;">
                    <label for="fteFrom" class="fte"># Total FTE</label>
                    <input #inputFTEMin
                        class="form-control fte"
                        style="text-align: end; margin-left: 3px"
                        id="fteMin" 
                        type="number"
                        placeholder="Min">
                  </div>

                  <span style="margin-top: 7px">-</span>

                  <div class="form-group" style="margin-bottom: 4px;"> 
                    <input #inputFTEMax
                        class="form-control fte"
                        style="text-align: end"
                        id="fteMax" 
                        type="number"
                        placeholder="Max"> 
                  </div>
                  <button type="button" class="btn btn-outline-dark go-btn" (click)="onFTETotalGoClick(inputFTEMin.value, inputFTEMax.value)">Go</button>
              </div>

            </div>

            <div style="height:10px; background: #f5f5f5"></div>
            
            <!-- PLC SCHEDULE -->
            <div class="filter-headers d-flex justify-content-between">
              <div data-toggle="collapse" data-target="#plc">                
                <i class="fa fa-angle-down" aria-hidden="true" style="padding: 0px 10px 0px 3px"></i>
                PLC Schedule
              </div>
              <div class="custom-control custom-checkbox" style="display: none;">
                <input type="checkbox" class="custom-control-input" id="PLCStatusIDs" (click)="onCheckAllClick($event)" [(ngModel)]="checkAllPLC">
                <label class="custom-control-label" for="PLCStatusIDs">
                  <small *ngIf="checkAllPLC" style="margin: 0px 5px 0px -7px;">Clear</small>
                  <small *ngIf="!checkAllPLC" style="margin: 0px 5px 0px -7px;">All</small>
                </label>
              </div>
            </div>

            <div class="filter-collapse show" id="plc">

              <ng-container *ngFor="let plcStatus of plcStatuses; let l = index">
                <div class="d-flex justify-content-between" style="margin-top: 5px">
                  <!-- plc status checkbox -->
                  <div class="custom-control custom-checkbox adv-filter-cb" style="margin: 2px 3px 0px 3px;">
                    <input type="checkbox" [checked]="checkAllPLC" class="custom-control-input" [attr.name]="plcStatus.PLCStatusName" [attr.id]="'plcStatus' + l" [(ngModel)]="plcStatus.state" (click)="onCheckboxPLCScheduleClick(l, $event, plcStatus)">
                    <label class="custom-control-label" [attr.for]="'plcStatus' + l" style="margin-left: 8px">{{ plcStatus.PLCStatusName }}</label>
                  </div>
                  <!-- plc status dates -->
                  <div class="d-flex justify-content-between">
                    <input #inputPLCFrom 
                        class="form-control fte" 
                        [class.plc-input-invalid]="inputPLCFrom.validity.valid===false" 
                        id="plcFrom" 
                        type="date" 
                        [min]="minDate"  
                        style="margin-top: 0px" 
                        [disabled]="!plcStatus.state" 
                        (change)="onInputPLCChange($event, l)">
                    <span style="margin: 0px 5px">-</span>
                    <input #inputPLCTo 
                        class="form-control fte" 
                        [class.plc-input-invalid]="inputPLCTo.validity.valid===false" 
                        id="plcTo" 
                        type="date" 
                        [min]="minDate" 
                        style="margin-top: 0px" 
                        [disabled]="!plcStatus.state" 
                        (change)="onInputPLCChange($event, l)">
                  </div>
                </div>
              </ng-container>             

            </div>

          </div>
        </div>
        
      </div> <!-- End Filter Column -->

      <!-- Results Table Column -->
      <div class="adv-results-cont">
        <table class="table table-hover filter-results">
          <thead class="thead-light">
            <tr>
              <th scope="col">Project Name</th>
              <th scope="col">Type</th>
              <th scope="col">Priority</th>
              <th scope="col">Status</th>
              <th scope="col">Owner</th>
              <th scope="col" *ngIf="this.filterObject.FTEMin != 'NULL' || this.filterObject.FTEMax != 'NULL' || this.filterObject.FTEDateFrom != 'NULL' || this.filterObject.FTEDateTo != 'NULL'">Total FTE</th>
              <th scope="col" *ngFor="let name of plcSchedules">{{ name.PLCStatusName }}</th>              
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let project of advancedFilteredResults | filter : filterString : 'ProjectName': {matchFuzzy: {on: true}}; let c = count">            
              <td>{{ project.ProjectName }}</td>
              <td>{{ project.ProjectTypeName }}</td>
              <td>{{ project.PriorityName }}</td>
              <td>{{ project.ProjectStatusName }}</td>
              <td>{{ project.ProjectOwnerName }}</td>
              <td *ngIf="this.filterObject.FTEMin != 'NULL' || this.filterObject.FTEMax != 'NULL' || this.filterObject.FTEDateFrom != 'NULL' || this.filterObject.FTEDateTo != 'NULL'">{{ project.TotalProjectFTE }}</td>
              <ng-container *ngFor="let schedule of project.Schedules">
                <td>{{ schedule.PLCDate }}</td>
              </ng-container>              
            </tr>
          </tbody>
        </table>
      </div>

    </div>

  </div>

</div>
